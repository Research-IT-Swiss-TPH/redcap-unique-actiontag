"use strict";function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}var STPH_UniqueAT=STPH_UniqueAT||{};STPH_UniqueAT.log=function(){if(STPH_UniqueAT.params.debug)switch(arguments.length){case 1:return void console.log(arguments[0]);case 2:return void console.log(arguments[0],arguments[1]);case 3:return void console.log(arguments[0],arguments[1],arguments[2]);case 4:return void console.log(arguments[0],arguments[1],arguments[2],arguments[3]);default:console.log(arguments);}},STPH_UniqueAT.init=function(){STPH_UniqueAT.log("Unique Action Tag - Initializing",STPH_UniqueAT),$("#field_validation_error_state").val(1),STPH_UniqueAT.params.errors,Object.keys(STPH_UniqueAT.params.actionTags).forEach(function(a){var b=STPH_UniqueAT.params.actionTags[a];Object.values(b).forEach(function(a){if("text"==a.type)for(var b=0;b<a.tagPerFieldCount;b++)a[b]&&new STPH_UniqueAT.ActionTagClass(a[b],a.tag).init()})})},STPH_UniqueAT.ActionTagClass=function(){function a(b,c){_classCallCheck(this,a),this.atv=b,this.ob=document.getElementsByName(this.atv.field)[0],this.request=STPH_UniqueAT.request,this.requestUrl=STPH_UniqueAT.request.url,this.requestData={tag:c,value:null,field:this.atv.field,targets:this.atv.targets,pid:this.request.pid,record:this.request.record,event_id:this.request.event_id,instance:this.request.instance}}return _createClass(a,[{key:"init",value:function init(){this.writeLabels(),this.bindOnBlur(),this.ajaxCheckUnique("on-load")}},{key:"writeLabels",value:function writeLabels(){if(STPH_UniqueAT.params.labels){STPH_UniqueAT.log("["+this.requestData.tag+"]["+this.atv.field+"] Apply actiontag with target(s): "+this.atv.targets+".)");var a=$("#label-"+this.atv.field+" tr").find("td:first");a.html(a.text()+"<div style=\"font-weight:100;font-size:12px;\">("+this.requestData.tag+")</div>")}}},{key:"bindOnBlur",value:function bindOnBlur(){var a=this;STPH_UniqueAT.log("["+this.requestData.tag+"]["+this.atv.field+"] Bind \"onblur\" event."),$("input[name="+this.atv.field+"]").bind("blur",function(){a.ajaxCheckUnique("on-blur")})}},{key:"ajaxCheckUnique",value:function ajaxCheckUnique(a){var b=this;this.requestData.value=trim(this.ob.value),0<this.requestData.value.length?(this.toggleUI("start-load"),$.post(this.requestUrl,{data:this.requestData}).done(function(c){0==c?b.toggleUI("remove-duplicate"):b.toggleUI("show-duplicate","on-blur"==a),b.toggleUI("stop-load")}).fail(function(a){STPH_UniqueAT.log(a),alert(woops),b.toggleUI("stop-load")})):this.toggleUI("remove-duplicate")}},{key:"toggleUI",value:function toggleUI(a){var b=!!(1<arguments.length&&void 0!==arguments[1])&&arguments[1];"start-load"===a?(this.ob.classList.add("loading-unique"),$("#formSaveTip button, #form :input[name=\""+this.atv.field+"\"], #form button").prop("disabled",!0)):"stop-load"===a?(this.ob.classList.remove("loading-unique"),$("#formSaveTip button, #form :input[name=\""+this.atv.field+"\"], #form button").prop("disabled",!1)):"show-duplicate"===a?(STPH_UniqueAT.log("Detect duplicate for field "+this.atv.field),b&&simpleDialog("The current field is a unique field (@UNIQUE action tag)"+lang.data_entry_107+" "+lang.data_entry_109+" "+lang.data_entry_110+" "+lang.data_entry_111+" ("+this.ob.value+") "+lang.period+" "+lang.data_entry_108,lang.data_entry_105,"suf_warning_dialog",500,"$('#form :input[name="+this.atv.field+"]').focus();",lang.calendar_popup_01),this.ob.style.fontWeight="bold",this.ob.style.backgroundColor="#FFB7BE"):"remove-duplicate"===a?(this.ob.style.fontWeight="normal",this.ob.style.backgroundColor="#FFFFFF"):void 0}}]),a}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9qcy91bmlxdWUuanMiXSwibmFtZXMiOlsiU1RQSF9VbmlxdWVBVCIsImxvZyIsInBhcmFtcyIsImRlYnVnIiwiYXJndW1lbnRzIiwibGVuZ3RoIiwiY29uc29sZSIsImluaXQiLCIkIiwidmFsIiwiZXJyb3JzIiwiT2JqZWN0Iiwia2V5cyIsImFjdGlvblRhZ3MiLCJmb3JFYWNoIiwiYWN0aW9uVGFnTmFtZSIsImFjdGlvblRhZ3NPYmplY3QiLCJ2YWx1ZXMiLCJmaWVsZEluZm8iLCJ0eXBlIiwiaSIsInRhZ1BlckZpZWxkQ291bnQiLCJBY3Rpb25UYWdDbGFzcyIsInRhZyIsImFjdGlvblRhZ1ZhbHVlIiwiYWN0aW9uVGFnTGl0ZXJhbCIsImF0diIsIm9iIiwiZG9jdW1lbnQiLCJnZXRFbGVtZW50c0J5TmFtZSIsImZpZWxkIiwicmVxdWVzdCIsInJlcXVlc3RVcmwiLCJ1cmwiLCJyZXF1ZXN0RGF0YSIsInZhbHVlIiwidGFyZ2V0cyIsInBpZCIsInJlY29yZCIsImV2ZW50X2lkIiwiaW5zdGFuY2UiLCJ3cml0ZUxhYmVscyIsImJpbmRPbkJsdXIiLCJhamF4Q2hlY2tVbmlxdWUiLCJsYWJlbHMiLCJsYWJlbCIsImZpbmQiLCJodG1sIiwidGV4dCIsImJpbmQiLCJ0cmlnZ2VyIiwidHJpbSIsInRvZ2dsZVVJIiwicG9zdCIsImRhdGEiLCJkb25lIiwicmVzcG9uc2UiLCJmYWlsIiwiZXJyb3IiLCJhbGVydCIsIndvb3BzIiwicGhhc2UiLCJkaWFsb2ciLCJjbGFzc0xpc3QiLCJhZGQiLCJwcm9wIiwicmVtb3ZlIiwic2ltcGxlRGlhbG9nIiwibGFuZyIsImRhdGFfZW50cnlfMTA3IiwiZGF0YV9lbnRyeV8xMDkiLCJkYXRhX2VudHJ5XzExMCIsImRhdGFfZW50cnlfMTExIiwicGVyaW9kIiwiZGF0YV9lbnRyeV8xMDgiLCJkYXRhX2VudHJ5XzEwNSIsImNhbGVuZGFyX3BvcHVwXzAxIiwic3R5bGUiLCJmb250V2VpZ2h0IiwiYmFja2dy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QThCbEIsa0JBOUJrQixHQUNwQmxCLENBRG9CLEVBK0JuQixLQUFLbEMsRUFBTCxDQUFRa0QsS0FBUixDQUFjQyxVQUFkLENBQTJCLFFBL0JSLENBZ0NuQixLQUFLbkQsRUFBTCxDQUFRa0QsS0FBUixDQUFjRSxlQUFkLENBQWdDLFNBaENiLFFBbUM5QixDQXpHTCxRIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXHJcbiAqIFVuaXF1ZSAtIGEgUkVEQ2FwIEN1c3RvbSBBY3Rpb24gVGFnXHJcbiAqICByZXBvc2l0b3J5IHVybFxyXG4gKi9cclxuXHJcbiB2YXIgU1RQSF9VbmlxdWVBVCA9IFNUUEhfVW5pcXVlQVQgfHwge307XHJcblxyXG4gLy8gRGVidWcgbG9nZ2luZ1xyXG4gU1RQSF9VbmlxdWVBVC5sb2cgPSBmdW5jdGlvbigpIHtcclxuICAgIGlmIChTVFBIX1VuaXF1ZUFULnBhcmFtcy5kZWJ1Zykge1xyXG4gICAgICAgIHN3aXRjaChhcmd1bWVudHMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIGNhc2UgMTogXHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhhcmd1bWVudHNbMF0pOyBcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgY2FzZSAyOiBcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGFyZ3VtZW50c1swXSwgYXJndW1lbnRzWzFdKTsgXHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIGNhc2UgMzogXHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhhcmd1bWVudHNbMF0sIGFyZ3VtZW50c1sxXSwgYXJndW1lbnRzWzJdKTsgXHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIGNhc2UgNDpcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGFyZ3VtZW50c1swXSwgYXJndW1lbnRzWzFdLCBhcmd1bWVudHNbMl0sIGFyZ3VtZW50c1szXSk7IFxyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coYXJndW1lbnRzKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn07XHJcblxyXG4vLyBJbml0aWFsaXphdGlvblxyXG5TVFBIX1VuaXF1ZUFULmluaXQgPSBmdW5jdGlvbigpIHtcclxuXHJcbiAgICBTVFBIX1VuaXF1ZUFULmxvZyhcIlVuaXF1ZSBBY3Rpb24gVGFnIC0gSW5pdGlhbGl6aW5nXCIsIFNUUEhfVW5pcXVlQVQpO1xyXG5cclxuICAgIC8vICBUaGlzIGlzIG5vdCBjbGVhbiwgYnV0IGNhbm5vdCBvdGhlcndpc2UgcHJldmVudCBmb3JtIHN1Ym1pdCBvbiBlbnRlciwgaS5lLnByZXZlbnREZWZhdWx0KCkgb24ga2V5ZG93biBoYXMgbm8gZWZmZWN0IG9uIGZvcm0gc3VibWlzc2lvbi4gV291bGQgYmUgaGFwcHkgYWJvdXQgYSBmaXggOilcclxuICAgICQoJyNmaWVsZF92YWxpZGF0aW9uX2Vycm9yX3N0YXRlJykudmFsKDEpXHJcblxyXG4gICAgLy8gQ2hlY2sgZm9yIGVycm9yc1xyXG4gICAgaWYgKFNUUEhfVW5pcXVlQVQucGFyYW1zLmVycm9ycykge1xyXG4gICAgICAgIC8vc2hvd0Vycm9yKFNUUEhfVW5pcXVlQVQucGFyYW1zLnVuaXF1ZSk7ICAgICAgICBcclxuICAgIH1cclxuXHJcbiAgICAvLyBMb29wIG92ZXIgYWxsIEFjdGlvbiBUYWdzIGFuZCBpbml0aWF0ZSBhIGNsYXNzIGZvciBlYWNoIGZpZWxkIHRoYXQgaGFzIGEgdmFsaWQgQWN0aW9uIFRhZ1xyXG4gICAgT2JqZWN0LmtleXMoU1RQSF9VbmlxdWVBVC5wYXJhbXMuYWN0aW9uVGFncykuZm9yRWFjaChmdW5jdGlvbihhY3Rpb25UYWdOYW1lKXtcclxuICAgICAgICB2YXIgYWN0aW9uVGFnc09iamVjdCA9IFNUUEhfVW5pcXVlQVQucGFyYW1zLmFjdGlvblRhZ3NbYWN0aW9uVGFnTmFtZV07XHJcbiAgICAgICAgT2JqZWN0LnZhbHVlcyhhY3Rpb25UYWdzT2JqZWN0KS5mb3JFYWNoKCAoZmllbGRJbmZvKSA9PiB7XHJcblxyXG4gICAgICAgICAgICAvLyAgT25seSBhY2NlcHQgZmllbGQgdHlwZSBcInRleHRcIlxyXG4gICAgICAgICAgICBpZihmaWVsZEluZm8udHlwZSA9PSBcInRleHRcIikge1xyXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBmaWVsZEluZm8udGFnUGVyRmllbGRDb3VudDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGZpZWxkSW5mb1tpXSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBuZXcgU1RQSF9VbmlxdWVBVC5BY3Rpb25UYWdDbGFzcyhmaWVsZEluZm9baV0sIGZpZWxkSW5mby50YWcpLmluaXQoKTsgIFxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pXHJcbiAgICB9KTtcclxuXHJcbn1cclxuXHJcblNUUEhfVW5pcXVlQVQuQWN0aW9uVGFnQ2xhc3MgPSBjbGFzcyB7XHJcblxyXG4gICAgY29uc3RydWN0b3IoYWN0aW9uVGFnVmFsdWUsIGFjdGlvblRhZ0xpdGVyYWwpIHtcclxuICAgICAgICB0aGlzLmF0diA9IGFjdGlvblRhZ1ZhbHVlO1xyXG4gICAgICAgIHRoaXMub2IgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5TmFtZSh0aGlzLmF0di5maWVsZClbMF07XHJcbiAgICAgICAgdGhpcy5yZXF1ZXN0ID0gU1RQSF9VbmlxdWVBVC5yZXF1ZXN0LFxyXG4gICAgICAgIHRoaXMucmVxdWVzdFVybCA9ICBTVFBIX1VuaXF1ZUFULnJlcXVlc3QudXJsLFxyXG4gICAgICAgIHRoaXMucmVxdWVzdERhdGEgPSB7XHJcbiAgICAgICAgICAgIHRhZzogYWN0aW9uVGFnTGl0ZXJhbCxcclxuICAgICAgICAgICAgdmFsdWU6IG51bGwsXHJcbiAgICAgICAgICAgIGZpZWxkOiB0aGlzLmF0di5maWVsZCxcclxuICAgICAgICAgICAgdGFyZ2V0czogdGhpcy5hdHYudGFyZ2V0cyxcclxuICAgICAgICAgICAgcGlkOiAgdGhpcy5yZXF1ZXN0LnBpZCxcclxuICAgICAgICAgICAgcmVjb3JkOiAgdGhpcy5yZXF1ZXN0LnJlY29yZCxcclxuICAgICAgICAgICAgZXZlbnRfaWQ6ICB0aGlzLnJlcXVlc3QuZXZlbnRfaWQsXHJcbiAgICAgICAgICAgIGluc3RhbmNlOiAgdGhpcy5yZXF1ZXN0Lmluc3RhbmNlXHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGluaXQoKSB7XHJcbiAgICAgICAgdGhpcy53cml0ZUxhYmVscygpO1xyXG4gICAgICAgIHRoaXMuYmluZE9uQmx1cigpO1xyXG4gICAgICAgIHRoaXMuYWpheENoZWNrVW5pcXVlKCdvbi1sb2FkJyk7XHJcbiAgICB9XHJcblxyXG4gICAgd3JpdGVMYWJlbHMoKSB7XHJcbiAgICAgICAgaWYgKFNUUEhfVW5pcXVlQVQucGFyYW1zLmxhYmVscykge1xyXG4gICAgICAgICAgICBTVFBIX1VuaXF1ZUFULmxvZygnWycrIHRoaXMucmVxdWVzdERhdGEudGFnICsnXVsnICsgdGhpcy5hdHYuZmllbGQgKyAnXSBBcHBseSBhY3Rpb250YWcgd2l0aCB0YXJnZXQocyk6ICcgKyB0aGlzLmF0di50YXJnZXRzICsgJy4pJyk7XHJcbiAgICAgICAgICAgIHZhciBsYWJlbCA9ICQoJyNsYWJlbC0nK3RoaXMuYXR2LmZpZWxkKycgdHInKS5maW5kKFwidGQ6Zmlyc3RcIik7XHJcbiAgICAgICAgICAgIGxhYmVsLmh0bWwobGFiZWwudGV4dCgpICsgJzxkaXYgc3R5bGU9XCJmb250LXdlaWdodDoxMDA7Zm9udC1zaXplOjEycHg7XCI+KCcrdGhpcy5yZXF1ZXN0RGF0YS50YWcrJyk8L2Rpdj4nKVxyXG4gICAgICAgIH1cclxuXHJcbiAgICB9XHJcblxyXG4gICAgYmluZE9uQmx1cigpIHtcclxuICAgICAgICBTVFBIX1VuaXF1ZUFULmxvZygnWycrIHRoaXMucmVxdWVzdERhdGEudGFnICsnXVsnICsgdGhpcy5hdHYuZmllbGQgKyAnXSBCaW5kIFwib25ibHVyXCIgZXZlbnQuJyk7ICAgICAgICBcclxuICAgICAgICAkKCdpbnB1dFtuYW1lPScgKyB0aGlzLmF0di5maWVsZCArICddJykuYmluZCgnYmx1cicsICgpID0+IHtcclxuICAgICAgICAgICAgdGhpcy5hamF4Q2hlY2tVbmlxdWUoJ29uLWJsdXInKTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBhamF4Q2hlY2tVbmlxdWUodHJpZ2dlcikge1xyXG4gICAgICAgIHZhciBkaWFsb2cgPSB0cmlnZ2VyID09ICdvbi1ibHVyJyA/IHRydWUgOiBmYWxzZTtcclxuICAgICAgICB0aGlzLnJlcXVlc3REYXRhLnZhbHVlID0gdHJpbSh0aGlzLm9iLnZhbHVlKTtcclxuXHJcbiAgICAgICAgaWYodGhpcy5yZXF1ZXN0RGF0YS52YWx1ZS5sZW5ndGggPiAwICkge1xyXG4gICAgICAgICAgICB0aGlzLnRvZ2dsZVVJKCdzdGFydC1sb2FkJyk7XHJcblxyXG4gICAgICAgICAgICAkLnBvc3QoIFxyXG4gICAgICAgICAgICAgICAgdGhpcy5yZXF1ZXN0VXJsLCBcclxuICAgICAgICAgICAgICAgIHsgXHJcbiAgICAgICAgICAgICAgICAgICAgZGF0YTogdGhpcy5yZXF1ZXN0RGF0YSBcclxuICAgICAgICAgICAgICAgIH0gXHJcbiAgICAgICAgICAgIClcclxuICAgICAgICAgICAgLmRvbmUoKHJlc3BvbnNlKSA9PiB7XHJcblxyXG4gICAgICAgICAgICAgICAgcmVzcG9uc2UgIT0gMCA/IHRoaXMudG9nZ2xlVUkoJ3Nob3ctZHVwbGljYXRlJywgZGlhbG9nKSA6IHRoaXMudG9nZ2xlVUkoJ3JlbW92ZS1kdXBsaWNhdGUnKTsgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIHRoaXMudG9nZ2xlVUkoJ3N0b3AtbG9hZCcpO1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAuZmFpbCggKGVycm9yKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBTVFBIX1VuaXF1ZUFULmxvZyhlcnJvcik7XHJcbiAgICAgICAgICAgICAgICBhbGVydCh3b29wcyk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnRvZ2dsZVVJKCdzdG9wLWxvYWQnKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLnRvZ2dsZVVJKCdyZW1vdmUtZHVwbGljYXRlJyk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHRvZ2dsZVVJKHBoYXNlLCBkaWFsb2cgPSBmYWxzZSl7XHJcbiAgICAgICAgc3dpdGNoKHBoYXNlKSB7XHJcbiAgICAgICAgICAgIGNhc2UgJ3N0YXJ0LWxvYWQnOlxyXG4gICAgICAgICAgICAgICAgdGhpcy5vYi5jbGFzc0xpc3QuYWRkKCdsb2FkaW5nLXVuaXF1ZScpO1xyXG4gICAgICAgICAgICAgICAgJCgnI2Zvcm1TYXZlVGlwIGJ1dHRvbiwgI2Zvcm0gOmlucHV0W25hbWU9XCInKyB0aGlzLmF0di5maWVsZCArJ1wiXSwgI2Zvcm0gYnV0dG9uJykucHJvcChcImRpc2FibGVkXCIsIHRydWUpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgY2FzZSAnc3RvcC1sb2FkJzogXHJcbiAgICAgICAgICAgICAgICB0aGlzLm9iLmNsYXNzTGlzdC5yZW1vdmUoJ2xvYWRpbmctdW5pcXVlJyk7XHJcbiAgICAgICAgICAgICAgICAkKCcjZm9ybVNhdmVUaXAgYnV0dG9uLCAjZm9ybSA6aW5wdXRbbmFtZT1cIicrIHRoaXMuYXR2LmZpZWxkKydcIl0sICNmb3JtIGJ1dHRvbicpLnByb3AoXCJkaXNhYmxlZFwiLCBmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGNhc2UgJ3Nob3ctZHVwbGljYXRlJzogICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICBTVFBIX1VuaXF1ZUFULmxvZygnRGV0ZWN0IGR1cGxpY2F0ZSBmb3IgZmllbGQgJyArIHRoaXMuYXR2LmZpZWxkICk7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYoZGlhbG9nKXtcclxuICAgICAgICAgICAgICAgICAgICBzaW1wbGVEaWFsb2coXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICdUaGUgY3VycmVudCBmaWVsZCBpcyBhIHVuaXF1ZSBmaWVsZCAoQFVOSVFVRSBhY3Rpb24gdGFnKScrbGFuZy5kYXRhX2VudHJ5XzEwNysnICcrbGFuZy5kYXRhX2VudHJ5XzEwOSsnICcrbGFuZy5kYXRhX2VudHJ5XzExMCsnICcgKyBsYW5nLmRhdGFfZW50cnlfMTExKycgKCcgKyB0aGlzLm9iLnZhbHVlICsgJykgJytsYW5nLnBlcmlvZCsnICcrbGFuZy5kYXRhX2VudHJ5XzEwOCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgbGFuZy5kYXRhX2VudHJ5XzEwNSwgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICdzdWZfd2FybmluZ19kaWFsb2cnLCBcclxuICAgICAgICAgICAgICAgICAgICAgICAgNTAwLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBcIiQoJyNmb3JtIDppbnB1dFtuYW1lPVwiK3RoaXMuYXR2LmZpZWxkK1wiXScpLmZvY3VzKCk7XCIsIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBsYW5nLmNhbGVuZGFyX3BvcHVwXzAxXHJcbiAgICAgICAgICAgICAgICAgICAgKTsgICAgIFxyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIHRoaXMub2Iuc3R5bGUuZm9udFdlaWdodCA9ICdib2xkJzsgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICB0aGlzLm9iLnN0eWxlLmJhY2tncm91bmRDb2xvciA9ICcjRkZCN0JFJzsgICAgICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgY2FzZSAncmVtb3ZlLWR1cGxpY2F0ZSc6XHJcbiAgICAgICAgICAgICAgICB0aGlzLm9iLnN0eWxlLmZvbnRXZWlnaHQgPSAnbm9ybWFsJztcclxuICAgICAgICAgICAgICAgIHRoaXMub2Iuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gJyNGRkZGRkYnO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59Il19