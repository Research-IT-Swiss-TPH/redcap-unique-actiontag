"use strict";function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}var STPH_UniqueAT=STPH_UniqueAT||{};STPH_UniqueAT.log=function(){if(STPH_UniqueAT.params.debug)switch(arguments.length){case 1:return void console.log(arguments[0]);case 2:return void console.log(arguments[0],arguments[1]);case 3:return void console.log(arguments[0],arguments[1],arguments[2]);case 4:return void console.log(arguments[0],arguments[1],arguments[2],arguments[3]);default:console.log(arguments);}},STPH_UniqueAT.init=function(){STPH_UniqueAT.log("Unique Action Tag - Initializing",STPH_UniqueAT),$("#field_validation_error_state").val(1),STPH_UniqueAT.params.errors,Object.keys(STPH_UniqueAT.params.actionTags).forEach(function(a){var b=STPH_UniqueAT.params.actionTags[a];Object.values(b).forEach(function(a){if("text"==a.type)for(var b=0;b<a.tagPerFieldCount;b++)a[b]&&(a[b].tag=a.tag,new STPH_UniqueAT.ActionTagClass(a[b]).init())})})},STPH_UniqueAT.ActionTagClass=function(){function a(b){_classCallCheck(this,a),this.atv=b,this.ob=document.getElementsByName(this.atv.field)[0],this.request=STPH_UniqueAT.request,this.requestUrl=STPH_UniqueAT.request.url,this.requestData={tag:this.atv.tag,value:null,field:this.atv.field,targets:this.atv.targets,pid:this.request.pid,record:this.request.record,event_id:this.request.event_id,instance:this.request.instance}}return _createClass(a,[{key:"init",value:function init(){this.writeLabels(),this.bindOnChange(),this.bindOnBlur(),this.ajaxCheckUnique("on-load")}},{key:"writeLabels",value:function writeLabels(){if(STPH_UniqueAT.params.labels){STPH_UniqueAT.log("["+this.requestData.tag+"]["+this.atv.field+"] Apply actiontag with target(s): "+this.atv.targets+".)");var a=$("#label-"+this.atv.field+" tr").find("td:first");a.html(a.text()+"<div style=\"font-weight:100;font-size:12px;\">("+this.requestData.tag+")</div>")}}},{key:"bindOnChange",value:function bindOnChange(){var a=this;if("@UNIQUE-STRICT"==this.requestData.tag){var b=this.requestData.targets,c=function(c){b[c]==a.requestData.field?$("input[name="+b[c]+"]").bind("afterAjaxCheck",function(){console.log("After ajax done."),a.onPageCheckUnique(b[c])}):$("input[name="+b[c]+"]").bind("change",function(){a.onPageCheckUnique(b[c])})};for(var d in b)c(d)}}},{key:"onPageCheckUnique",value:function onPageCheckUnique(){var a=this;if(0<this.requestData.value.length){this.toggleUI("start-load");var b=[],c=this.requestData.targets.filter(function(b){return b!==a.requestData.field});c.forEach(function(c){var d=$("input[name="+c+"]");d.val()==a.requestData.value?(d.css("background-color","#FFB7BE"),d.css("font-weight","bold"),b.push(c)):(d.css("background-color","#FFFFFF"),d.css("font-weight","normal"))}),0<b.length?this.toggleUI("show-warning",!0,b):this.toggleUI("remove-warning"),this.toggleUI("stop-load")}else this.toggleUI("remove-warning")}},{key:"bindOnBlur",value:function bindOnBlur(){var a=this;STPH_UniqueAT.log("["+this.requestData.tag+"]["+this.atv.field+"] Bind \"onblur\" event."),$("input[name="+this.atv.field+"]").bind("blur",function(){a.ajaxCheckUnique("on-blur")})}},{key:"ajaxCheckUnique",value:function ajaxCheckUnique(a){var b=this;this.requestData.value=trim(this.ob.value),0<this.requestData.value.length?(this.toggleUI("start-load"),$.post(this.requestUrl,{data:this.requestData}).done(function(c){0==c?(b.toggleUI("remove-duplicate"),$("input[name="+b.requestData.field+"]").trigger("afterAjaxCheck")):b.toggleUI("show-duplicate","on-blur"==a),b.toggleUI("stop-load")}).fail(function(a){STPH_UniqueAT.log(a),alert(woops),b.toggleUI("stop-load")})):this.toggleUI("remove-duplicate")}},{key:"toggleUI",value:function toggleUI(a){var b=!!(1<arguments.length&&void 0!==arguments[1])&&arguments[1],c=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;"start-load"===a?(this.ob.classList.add("loading-unique"),$("#formSaveTip button, #form :input[name=\""+this.atv.field+"\"], #form button").prop("disabled",!0)):"stop-load"===a?(this.ob.classList.remove("loading-unique"),$("#formSaveTip button, #form :input[name=\""+this.atv.field+"\"], #form button").prop("disabled",!1)):"show-duplicate"===a?(STPH_UniqueAT.log("Detect duplicate for field "+this.atv.field),this.ob.style.fontWeight="bold",this.ob.style.backgroundColor="#FFB7BE",b&&simpleDialog("The current field is a unique field (@UNIQUE action tag)"+lang.data_entry_107+" "+lang.data_entry_109+" "+lang.data_entry_110+" "+lang.data_entry_111+" ("+this.ob.value+") "+lang.period+" "+lang.data_entry_108,lang.data_entry_105,"suf_warning_dialog",500,"$('#form :input[name="+this.atv.field+"]').focus();",lang.calendar_popup_01)):"show-warning"===a?(STPH_UniqueAT.log("Warn of duplicate for field "+this.atv.field),this.ob.style.fontWeight="bold",this.ob.style.backgroundColor="#FFB7BE",b&&simpleDialog("Warning: You have entered a duplicate value in field(s) "+c+"  in conflict to "+this.atv.field)):"remove-warning"===a?(this.ob.style.fontWeight="normal",this.ob.style.backgroundColor="#FFFFFF"):"remove-duplicate"===a?(this.ob.style.fontWeight="normal",this.ob.style.backgroundColor="#FFFFFF"):void 0}}]),a}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9qcy91bmlxdWUuanMiXSwibmFtZXMiOlsiU1RQSF9VbmlxdWVBVCIsImxvZyIsInBhcmFtcyIsImRlYnVnIiwiYXJndW1lbnRzIiwibGVuZ3RoIiwiY29uc29sZSIsImluaXQiLCIkIiwidmFsIiwiZXJyb3JzIiwiT2JqZWN0Iiwia2V5cyIsImFjdGlvblRhZ3MiLCJmb3JFYWNoIiwiYWN0aW9uVGFnTmFtZSIsImFjdGlvblRhZ3NPYmplY3QiLCJ2YWx1ZXMiLCJmaWVsZEluZm8iLCJ0eXBlIiwiaSIsInRhZ1BlckZpZWxkQ291bnQiLCJ0YWciLCJBY3Rpb25UYWdDbGFzcyIsImFjdGlvblRhZ1ZhbHVlIiwiYXR2Iiwib2IiLCJkb2N1bWVudCIsImdldEVsZW1lbnRzQnlOYW1lIiwiZmllbGQiLCJyZXF1ZXN0IiwicmVxdWVzdFVybCIsInVybCIsInJlcXVlc3REYXRhIiwidmFsdWUiLCJ0YXJnZXRzIiwicGlkIiwicmVjb3JkIiwiZXZlbnRfaWQiLCJpbnN0YW5jZSIsIndyaXRlTGFiZWxzIiwiYmluZE9uQ2hhbmdlIiwiYmluZE9uQmx1ciIsImFqYXhDaGVja1VuaXF1ZSIsImxhYmVscyIsImxhYmVsIiwiZmluZCIsImh0bWwiLCJ0ZXh0Iiwib2JqIiwicHJvcCIsImJpbmQiLCJvblBhZ2VDaGVja1VuaXF1ZSIsInRvZ2dsZVVJIiwid2FybmluZ3MiLCJmaWx0ZXJlZFRhcmdldHMiLCJmaWx0ZXIiLCJpdGVtIiwiaXRlbU9iaiIsImNzcyIsInB1c2giLCJ0cmlnZ2VyIiwidHJpbSIsInBvc3QiLCJkYXRhIiwiZG9uZSIsInJlc3BvbnNlIiwiZmFpbCIsImVycm9yIiwiYWxlcnQiLCJ3b29wcyIsInBoYXNlIiwiZGlhbG9nIiwiY2xhc3NMaXN0IiwiYWRkIiwicmVtb3ZlIiwic3R5bGUiLCJmb250V2VpZ2h0IiwiYmFja2dyb3VuZENvbG9yIiwic2ltcGxlRGlhbG9nIiwibGFuZyIsImRhdGFfZW50cnlfMTA3IiwiZGF0YV9lbnRyeV8xMDkiLCJkYXRhX2VudHJ5XzExMCIsImRhdGFfZW50cnlfMTExIiwicGVyaW9kIiwiZGF0YV9lbnRyeV8xMDgiLCJkYXRhX2VudHJ5XzEwNSIsImNhbGVuZGFyX3BvcHVwXzAxIl0sIm1hcHBpbmdzIjoiK1lBaUJDLEdBQUlBLENBQUFBLGFBQWEsQ0FBR0EsYUFBYSxFQUFJLEVBQXJDLENBR0FBLGFBQWEsQ0FBQ0MsR0FBZCxDQUFvQixVQUFXLENBQzVCLEdBQUlELGFBQWEsQ0FBQ0UsTUFBZCxDQUFxQkMsS0FBekIsQ0FDSSxPQUFPQyxTQUFTLENBQUNDLE1BQWpCLEVBQ0ksSUFBSyxFQUFMLENBRUksV0FEQUMsQ0FBQUEsT0FBTyxDQUFDTCxHQUFSLENBQVlHLFNBQVMsQ0FBQyxDQUFELENBQXJCLENBQ0EsQ0FDSixJQUFLLEVBQUwsQ0FFSSxXQURBRSxDQUFBQSxPQUFPLENBQUNMLEdBQVIsQ0FBWUcsU0FBUyxDQUFDLENBQUQsQ0FBckIsQ0FBMEJBLFNBQVMsQ0FBQyxDQUFELENBQW5DLENBQ0EsQ0FDSixJQUFLLEVBQUwsQ0FFSSxXQURBRSxDQUFBQSxPQUFPLENBQUNMLEdBQVIsQ0FBWUcsU0FBUyxDQUFDLENBQUQsQ0FBckIsQ0FBMEJBLFNBQVMsQ0FBQyxDQUFELENBQW5DLENBQXdDQSxTQUFTLENBQUMsQ0FBRCxDQUFqRCxDQUNBLENBQ0osSUFBSyxFQUFMLENBRUksV0FEQUUsQ0FBQUEsT0FBTyxDQUFDTCxHQUFSLENBQVlHLFNBQVMsQ0FBQyxDQUFELENBQXJCLENBQTBCQSxTQUFTLENBQUMsQ0FBRCxDQUFuQyxDQUF3Q0EsU0FBUyxDQUFDLENBQUQsQ0FBakQsQ0FBc0RBLFNBQVMsQ0FBQyxDQUFELENBQS9ELENBQ0EsQ0FDSixRQUNJRSxPQUFPLENBQUNMLEdBQVIsQ0FBWUcsU0FBWixDQURKLENBYkosQ0FpQlAsQyxDQUdESixhQUFhLENBQUNPLElBQWQsQ0FBcUIsVUFBVyxDQUU1QlAsYUFBYSxDQUFDQyxHQUFkLENBQWtCLGtDQUFsQixDQUFzREQsYUFBdEQsQ0FGNEIsQ0FLNUJR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akMsQ0FBdUMsY0FML0IsQ0FNUm1ELElBQUksQ0FBQ1EsaUJBTkcsQ0FqQm9CLEVBNEJuQyxjQTVCbUMsR0FDckNqQixDQURxQyxFQTZCcEN2RSxhQUFhLENBQUNDLEdBQWQsQ0FBa0IsK0JBQWlDLEtBQUt3QixHQUFMLENBQVNJLEtBQTVELENBN0JvQyxDQThCcEMsS0FBS0gsRUFBTCxDQUFRa0QsS0FBUixDQUFjQyxVQUFkLENBQTJCLE1BOUJTLENBK0JwQyxLQUFLbkQsRUFBTCxDQUFRa0QsS0FBUixDQUFjRSxlQUFkLENBQWdDLFNBL0JJLENBaUNqQ04sQ0FqQ2lDLEVBa0NoQ08sWUFBWSxDQUFDLDJEQUE0RHpCLENBQTVELENBQXNFLG1CQUF0RSxDQUE0RixLQUFLN0IsR0FBTCxDQUFTSSxLQUF0RyxDQWxDb0IsRUFzQ25DLGdCQXRDbUMsR0FDckMwQyxDQURxQyxFQXVDcEMsS0FBSzdDLEVBQUwsQ0FBUWtELEtBQVIsQ0FBY0MsVUFBZCxDQUEyQixRQXZDUyxDQXdDcEMsS0FBS25ELEVBQUwsQ0FBUWtELEtBQVIsQ0FBY0UsZUFBZCxDQUFnQyxTQXhDSSxFQTRDbkMsa0JBNUNtQyxHQUNyQ1AsQ0FEcUMsRUE2Q3BDLEtBQUs3QyxFQUFMLENBQVFrRCxLQUFSLENBQWNDLFVBQWQsQ0FBMkIsUUE3Q1MsQ0E4Q3BDLEtBQUtuRCxFQUFMLENBQVFrRCxLQUFSLENBQWNFLGVBQWQsQ0FBZ0MsU0E5Q0ksUUFpRC9DLENBbkxMLFEiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcclxuICogVW5pcXVlIEFjdGlvbiBUYWcgLSBBIFJFRENhcCBleHRlcm5hbCBtb2R1bGUgcHJvdmlkaW5nIGFjdGlvbiB0YWdzIHRoYXQgbWFrZSBmaWVsZHMgdW5pcXVlLlxyXG4gKiBBdXRob3I6IEVraW4gVGVydGVtaXpcclxuICogXHJcbiAqIFxyXG4gKiBEZXZlbG9wZXIgTm90ZTogQmFiZWwgSmF2YXNjcmlwdCBjb21waWxhdGlvblxyXG4gKiBUaGUgbW9kdWxlIGlzIHVzaW5nIGEgQmFiZWwgY29tcGlsZWQgdmVyc2lvbiBvZiB0aGlzIGNvZGUgdG8gZW5zdXJlIG1vZGVybiBKYXZhc2NyaXB0IGNhbiBiZSB1c2VkIHdpdGhvdXQgbG9zaW5nIEJyb3dzZXIgU3VwcG9ydC4gXHJcbiAqIFJ1biBgbnBtIHJ1biBidWlsZGAgb3IgYG5wbSBydW4gZGV2YCBhZnRlciBtYWtpbmcgY29kZSBjaGFuZ2VzIHRvIHlvdXIgSmF2YWNzcmlwdC5cclxuICogQWxzbyBlbnN1cmUgdGhhdCB5b3UgaGF2ZSBOb2RlLmpzIHJ1bm5pbmcgb24geW91ciBsb2NhbCBkZXZlbG9wbWVudCBtYWNoaW5lIFxyXG4gKiBhbmQgaGF2ZSBpbnN0YWxsZWQgYWxsIG5lY2Vzc2FyeSBsb2NhbCBkZXBlbmRlbmNpZXMgd2l0aCBgbnBtIGluc3RhbGxgLlxyXG4gKiBcclxuICogQ3JlZGl0czogXHJcbiAqIC0gR8O8bnRoZXIgUmV6bmljemVrOyBBIGxvdCBvZiB0aGlzIGNvZGUgaXMgYmFzZWQgb24gdGhlIFJFRENhcCBBdXRvZmlsbCBFeHRlcm5hbCBNb2R1bGUuIChodHRwczovL2dpdGh1Yi5jb20vZ3Jlem5pY3play9yZWRjYXBfYXV0b2ZpbGwpXHJcbiAqIC0gQW5keSBNYXJ0aW47IFRvIHBhcnNlIEFjdGlvblRhZ3MgZnJvbSB0aGUgZmllbGQgYW5ub3RhdGlvbnMgQWN0aW9uVGFnSGVscGVyIGNsYXNzIGlzIHVzZWQuIChodHRwczovL2dpc3QuZ2l0aHViLmNvbS8xMjNhbmR5L2RkMjYyNDM5YzA0NzhmZmJkMzdlNDY4NWJjODAxN2FjKVxyXG4gKiBcclxuICovXHJcblxyXG4gdmFyIFNUUEhfVW5pcXVlQVQgPSBTVFBIX1VuaXF1ZUFUIHx8IHt9O1xyXG5cclxuIC8vIERlYnVnIGxvZ2dpbmdcclxuIFNUUEhfVW5pcXVlQVQubG9nID0gZnVuY3Rpb24oKSB7XHJcbiAgICBpZiAoU1RQSF9VbmlxdWVBVC5wYXJhbXMuZGVidWcpIHtcclxuICAgICAgICBzd2l0Y2goYXJndW1lbnRzLmxlbmd0aCkge1xyXG4gICAgICAgICAgICBjYXNlIDE6IFxyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coYXJndW1lbnRzWzBdKTsgXHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIGNhc2UgMjogXHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhhcmd1bWVudHNbMF0sIGFyZ3VtZW50c1sxXSk7IFxyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICBjYXNlIDM6IFxyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coYXJndW1lbnRzWzBdLCBhcmd1bWVudHNbMV0sIGFyZ3VtZW50c1syXSk7IFxyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICBjYXNlIDQ6XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhhcmd1bWVudHNbMF0sIGFyZ3VtZW50c1sxXSwgYXJndW1lbnRzWzJdLCBhcmd1bWVudHNbM10pOyBcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGFyZ3VtZW50cyk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59O1xyXG5cclxuLy8gSW5pdGlhbGl6YXRpb25cclxuU1RQSF9VbmlxdWVBVC5pbml0ID0gZnVuY3Rpb24oKSB7XHJcblxyXG4gICAgU1RQSF9VbmlxdWVBVC5sb2coXCJVbmlxdWUgQWN0aW9uIFRhZyAtIEluaXRpYWxpemluZ1wiLCBTVFBIX1VuaXF1ZUFUKTtcclxuXHJcbiAgICAvLyAgVGhpcyBpcyBub3QgY2xlYW4sIGJ1dCBjYW5ub3Qgb3RoZXJ3aXNlIHByZXZlbnQgZm9ybSBzdWJtaXQgb24gZW50ZXIsIGkuZS5wcmV2ZW50RGVmYXVsdCgpIG9uIGtleWRvd24gaGFzIG5vIGVmZmVjdCBvbiBmb3JtIHN1Ym1pc3Npb24uIFdvdWxkIGJlIGhhcHB5IGFib3V0IGEgZml4IDopXHJcbiAgICAkKCcjZmllbGRfdmFsaWRhdGlvbl9lcnJvcl9zdGF0ZScpLnZhbCgxKVxyXG5cclxuICAgIC8vIENoZWNrIGZvciBlcnJvcnNcclxuICAgIGlmIChTVFBIX1VuaXF1ZUFULnBhcmFtcy5lcnJvcnMpIHtcclxuICAgICAgICAvL3Nob3dFcnJvcihTVFBIX1VuaXF1ZUFULnBhcmFtcy51bmlxdWUpOyAgICAgICAgXHJcbiAgICB9XHJcblxyXG4gICAgLy8gTG9vcCBvdmVyIGFsbCBBY3Rpb24gVGFncyBhbmQgaW5pdGlhdGUgYSBjbGFzcyBmb3IgZWFjaCBmaWVsZCB0aGF0IGhhcyBhIHZhbGlkIEFjdGlvbiBUYWdcclxuICAgIE9iamVjdC5rZXlzKFNUUEhfVW5pcXVlQVQucGFyYW1zLmFjdGlvblRhZ3MpLmZvckVhY2goZnVuY3Rpb24oYWN0aW9uVGFnTmFtZSl7XHJcbiAgICAgICAgdmFyIGFjdGlvblRhZ3NPYmplY3QgPSBTVFBIX1VuaXF1ZUFULnBhcmFtcy5hY3Rpb25UYWdzW2FjdGlvblRhZ05hbWVdO1xyXG4gICAgICAgIE9iamVjdC52YWx1ZXMoYWN0aW9uVGFnc09iamVjdCkuZm9yRWFjaCggKGZpZWxkSW5mbykgPT4ge1xyXG5cclxuICAgICAgICAgICAgLy8gIE9ubHkgYWNjZXB0IGZpZWxkIHR5cGUgXCJ0ZXh0XCJcclxuICAgICAgICAgICAgaWYoZmllbGRJbmZvLnR5cGUgPT0gXCJ0ZXh0XCIpIHtcclxuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZmllbGRJbmZvLnRhZ1BlckZpZWxkQ291bnQ7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChmaWVsZEluZm9baV0pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZmllbGRJbmZvW2ldW1widGFnXCJdID0gZmllbGRJbmZvLnRhZztcclxuICAgICAgICAgICAgICAgICAgICAgICAgbmV3IFNUUEhfVW5pcXVlQVQuQWN0aW9uVGFnQ2xhc3MoZmllbGRJbmZvW2ldKS5pbml0KCk7ICBcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KVxyXG4gICAgfSk7XHJcblxyXG59XHJcblxyXG5TVFBIX1VuaXF1ZUFULkFjdGlvblRhZ0NsYXNzID0gY2xhc3Mge1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKGFjdGlvblRhZ1ZhbHVlKSB7XHJcbiAgICAgICAgdGhpcy5hdHYgPSBhY3Rpb25UYWdWYWx1ZTtcclxuICAgICAgICB0aGlzLm9iID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeU5hbWUodGhpcy5hdHYuZmllbGQpWzBdO1xyXG4gICAgICAgIHRoaXMucmVxdWVzdCA9IFNUUEhfVW5pcXVlQVQucmVxdWVzdCxcclxuICAgICAgICB0aGlzLnJlcXVlc3RVcmwgPSAgU1RQSF9VbmlxdWVBVC5yZXF1ZXN0LnVybCxcclxuICAgICAgICB0aGlzLnJlcXVlc3REYXRhID0ge1xyXG4gICAgICAgICAgICB0YWc6IHRoaXMuYXR2LnRhZyxcclxuICAgICAgICAgICAgdmFsdWU6IG51bGwsXHJcbiAgICAgICAgICAgIGZpZWxkOiB0aGlzLmF0di5maWVsZCxcclxuICAgICAgICAgICAgdGFyZ2V0czogdGhpcy5hdHYudGFyZ2V0cyxcclxuICAgICAgICAgICAgcGlkOiAgdGhpcy5yZXF1ZXN0LnBpZCxcclxuICAgICAgICAgICAgcmVjb3JkOiAgdGhpcy5yZXF1ZXN0LnJlY29yZCxcclxuICAgICAgICAgICAgZXZlbnRfaWQ6ICB0aGlzLnJlcXVlc3QuZXZlbnRfaWQsXHJcbiAgICAgICAgICAgIGluc3RhbmNlOiAgdGhpcy5yZXF1ZXN0Lmluc3RhbmNlXHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGluaXQoKSB7XHJcbiAgICAgICAgdGhpcy53cml0ZUxhYmVscygpO1xyXG4gICAgICAgIHRoaXMuYmluZE9uQ2hhbmdlKCk7XHJcbiAgICAgICAgdGhpcy5iaW5kT25CbHVyKCk7XHJcbiAgICAgICAgdGhpcy5hamF4Q2hlY2tVbmlxdWUoJ29uLWxvYWQnKTtcclxuICAgIH1cclxuXHJcbiAgICB3cml0ZUxhYmVscygpIHtcclxuICAgICAgICBpZiAoU1RQSF9VbmlxdWVBVC5wYXJhbXMubGFiZWxzKSB7XHJcbiAgICAgICAgICAgIFNUUEhfVW5pcXVlQVQubG9nKCdbJysgdGhpcy5yZXF1ZXN0RGF0YS50YWcgKyddWycgKyB0aGlzLmF0di5maWVsZCArICddIEFwcGx5IGFjdGlvbnRhZyB3aXRoIHRhcmdldChzKTogJyArIHRoaXMuYXR2LnRhcmdldHMgKyAnLiknKTtcclxuICAgICAgICAgICAgdmFyIGxhYmVsID0gJCgnI2xhYmVsLScrdGhpcy5hdHYuZmllbGQrJyB0cicpLmZpbmQoXCJ0ZDpmaXJzdFwiKTtcclxuICAgICAgICAgICAgbGFiZWwuaHRtbChsYWJlbC50ZXh0KCkgKyAnPGRpdiBzdHlsZT1cImZvbnQtd2VpZ2h0OjEwMDtmb250LXNpemU6MTJweDtcIj4oJyt0aGlzLnJlcXVlc3REYXRhLnRhZysnKTwvZGl2PicpXHJcbiAgICAgICAgfVxyXG5cclxuICAgIH1cclxuXHJcbiAgICBiaW5kT25DaGFuZ2UoKSB7XHJcbiAgICAgICAgLy8gIE9ubHkgZm9yIEBVTklRVUUtU1RSSUNUIHRhZ3NcclxuICAgICAgICBpZih0aGlzLnJlcXVlc3REYXRhLnRhZyA9PSBcIkBVTklRVUUtU1RSSUNUXCIpIHtcclxuICAgICAgICAgICAgdmFyIG9iaiA9IHRoaXMucmVxdWVzdERhdGEudGFyZ2V0cztcclxuICAgICAgICAgICAgZm9yIChjb25zdCBwcm9wIGluIG9iaikge1xyXG4gICAgICAgICAgICAgICAgaWYgKCBvYmpbcHJvcF0gIT0gdGhpcy5yZXF1ZXN0RGF0YS5maWVsZCApIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyAgb2JqW3Byb3BdICE9IHRoaXMucmVxdWVzdERhdGEuZmllbGRcclxuICAgICAgICAgICAgICAgICAgICAkKCdpbnB1dFtuYW1lPScgKyBvYmpbcHJvcF0gKyAnXScpLmJpbmQoJ2NoYW5nZScsICgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5vblBhZ2VDaGVja1VuaXF1ZShvYmpbcHJvcF0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAkKCdpbnB1dFtuYW1lPScgKyBvYmpbcHJvcF0gKyAnXScpLmJpbmQoJ2FmdGVyQWpheENoZWNrJywgKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIkFmdGVyIGFqYXggZG9uZS5cIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMub25QYWdlQ2hlY2tVbmlxdWUob2JqW3Byb3BdKTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIG9uUGFnZUNoZWNrVW5pcXVlKCkge1xyXG4gICAgICAgIGlmKHRoaXMucmVxdWVzdERhdGEudmFsdWUubGVuZ3RoID4gMCApIHsgICAgICAgICAgICBcclxuICAgICAgICAgICAgdGhpcy50b2dnbGVVSSgnc3RhcnQtbG9hZCcpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgdmFyIHdhcm5pbmdzID0gW107ICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIHZhciBmaWx0ZXJlZFRhcmdldHMgPSB0aGlzLnJlcXVlc3REYXRhLnRhcmdldHMuZmlsdGVyKChpdGVtKSA9PiB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gaXRlbSAhPT0gdGhpcy5yZXF1ZXN0RGF0YS5maWVsZDtcclxuICAgICAgICAgICAgfSlcclxuXHJcbiAgICAgICAgICAgIGZpbHRlcmVkVGFyZ2V0cy5mb3JFYWNoKCAoaXRlbSkgPT4geyBcclxuICAgICAgICAgICAgICAgIHZhciBpdGVtT2JqID0gJCgnaW5wdXRbbmFtZT0nK2l0ZW0rJ10nKTtcclxuICAgICAgICAgICAgICAgIGlmKCBpdGVtT2JqLnZhbCgpID09IHRoaXMucmVxdWVzdERhdGEudmFsdWUgKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaXRlbU9iai5jc3MoXCJiYWNrZ3JvdW5kLWNvbG9yXCIsIFwiI0ZGQjdCRVwiKTtcclxuICAgICAgICAgICAgICAgICAgICBpdGVtT2JqLmNzcyhcImZvbnQtd2VpZ2h0XCIsIFwiYm9sZFwiKTtcclxuICAgICAgICAgICAgICAgICAgICB3YXJuaW5ncy5wdXNoKGl0ZW0pO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBpdGVtT2JqLmNzcyhcImJhY2tncm91bmQtY29sb3JcIiwgXCIjRkZGRkZGXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgIGl0ZW1PYmouY3NzKFwiZm9udC13ZWlnaHRcIiwgXCJub3JtYWxcIik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pXHJcblxyXG4gICAgICAgICAgICBpZih3YXJuaW5ncy5sZW5ndGggPiAwKXtcclxuICAgICAgICAgICAgICAgIHRoaXMudG9nZ2xlVUkoJ3Nob3ctd2FybmluZycsIHRydWUsIHdhcm5pbmdzKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRoaXMudG9nZ2xlVUkoJ3JlbW92ZS13YXJuaW5nJyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIHRoaXMudG9nZ2xlVUkoJ3N0b3AtbG9hZCcpO1xyXG5cclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLnRvZ2dsZVVJKCdyZW1vdmUtd2FybmluZycpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBiaW5kT25CbHVyKCkge1xyXG4gICAgICAgIFNUUEhfVW5pcXVlQVQubG9nKCdbJysgdGhpcy5yZXF1ZXN0RGF0YS50YWcgKyddWycgKyB0aGlzLmF0di5maWVsZCArICddIEJpbmQgXCJvbmJsdXJcIiBldmVudC4nKTsgICAgICAgIFxyXG4gICAgICAgICQoJ2lucHV0W25hbWU9JyArIHRoaXMuYXR2LmZpZWxkICsgJ10nKS5iaW5kKCdibHVyJywgKCkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLmFqYXhDaGVja1VuaXF1ZSgnb24tYmx1cicpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIGFqYXhDaGVja1VuaXF1ZSh0cmlnZ2VyKSB7XHJcbiAgICAgICAgdmFyIGRpYWxvZyA9IHRyaWdnZXIgPT0gJ29uLWJsdXInID8gdHJ1ZSA6IGZhbHNlO1xyXG4gICAgICAgIHRoaXMucmVxdWVzdERhdGEudmFsdWUgPSB0cmltKHRoaXMub2IudmFsdWUpO1xyXG5cclxuICAgICAgICBpZih0aGlzLnJlcXVlc3REYXRhLnZhbHVlLmxlbmd0aCA+IDAgKSB7XHJcbiAgICAgICAgICAgIHRoaXMudG9nZ2xlVUkoJ3N0YXJ0LWxvYWQnKTtcclxuXHJcbiAgICAgICAgICAgICQucG9zdCggXHJcbiAgICAgICAgICAgICAgICB0aGlzLnJlcXVlc3RVcmwsIFxyXG4gICAgICAgICAgICAgICAgeyBcclxuICAgICAgICAgICAgICAgICAgICBkYXRhOiB0aGlzLnJlcXVlc3REYXRhIFxyXG4gICAgICAgICAgICAgICAgfSBcclxuICAgICAgICAgICAgKVxyXG4gICAgICAgICAgICAuZG9uZSgocmVzcG9uc2UpID0+IHtcclxuXHJcbiAgICAgICAgICAgICAgICBpZihyZXNwb25zZSAhPSAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy50b2dnbGVVSSgnc2hvdy1kdXBsaWNhdGUnLCBkaWFsb2cpXHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMudG9nZ2xlVUkoJ3JlbW92ZS1kdXBsaWNhdGUnKTtcclxuICAgICAgICAgICAgICAgICAgICAkKCdpbnB1dFtuYW1lPScgKyB0aGlzLnJlcXVlc3REYXRhLmZpZWxkICsgJ10nKS50cmlnZ2VyKFwiYWZ0ZXJBamF4Q2hlY2tcIik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB0aGlzLnRvZ2dsZVVJKCdzdG9wLWxvYWQnKTtcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgLmZhaWwoIChlcnJvcikgPT4ge1xyXG4gICAgICAgICAgICAgICAgU1RQSF9VbmlxdWVBVC5sb2coZXJyb3IpO1xyXG4gICAgICAgICAgICAgICAgYWxlcnQod29vcHMpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy50b2dnbGVVSSgnc3RvcC1sb2FkJyk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy50b2dnbGVVSSgncmVtb3ZlLWR1cGxpY2F0ZScpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICB0b2dnbGVVSShwaGFzZSwgZGlhbG9nID0gZmFsc2UsIHdhcm5pbmdzID0gbnVsbCl7XHJcbiAgICAgICAgc3dpdGNoKHBoYXNlKSB7XHJcbiAgICAgICAgICAgIGNhc2UgJ3N0YXJ0LWxvYWQnOlxyXG4gICAgICAgICAgICAgICAgdGhpcy5vYi5jbGFzc0xpc3QuYWRkKCdsb2FkaW5nLXVuaXF1ZScpO1xyXG4gICAgICAgICAgICAgICAgJCgnI2Zvcm1TYXZlVGlwIGJ1dHRvbiwgI2Zvcm0gOmlucHV0W25hbWU9XCInKyB0aGlzLmF0di5maWVsZCArJ1wiXSwgI2Zvcm0gYnV0dG9uJykucHJvcChcImRpc2FibGVkXCIsIHRydWUpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgY2FzZSAnc3RvcC1sb2FkJzogXHJcbiAgICAgICAgICAgICAgICB0aGlzLm9iLmNsYXNzTGlzdC5yZW1vdmUoJ2xvYWRpbmctdW5pcXVlJyk7XHJcbiAgICAgICAgICAgICAgICAkKCcjZm9ybVNhdmVUaXAgYnV0dG9uLCAjZm9ybSA6aW5wdXRbbmFtZT1cIicrIHRoaXMuYXR2LmZpZWxkKydcIl0sICNmb3JtIGJ1dHRvbicpLnByb3AoXCJkaXNhYmxlZFwiLCBmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGNhc2UgJ3Nob3ctZHVwbGljYXRlJzogICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICBTVFBIX1VuaXF1ZUFULmxvZygnRGV0ZWN0IGR1cGxpY2F0ZSBmb3IgZmllbGQgJyArIHRoaXMuYXR2LmZpZWxkICk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLm9iLnN0eWxlLmZvbnRXZWlnaHQgPSAnYm9sZCc7ICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgdGhpcy5vYi5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSAnI0ZGQjdCRSc7XHJcbiAgICAgICAgICAgICAgICBpZihkaWFsb2cpe1xyXG4gICAgICAgICAgICAgICAgICAgIHNpbXBsZURpYWxvZyhcclxuICAgICAgICAgICAgICAgICAgICAgICAgJ1RoZSBjdXJyZW50IGZpZWxkIGlzIGEgdW5pcXVlIGZpZWxkIChAVU5JUVVFIGFjdGlvbiB0YWcpJytsYW5nLmRhdGFfZW50cnlfMTA3KycgJytsYW5nLmRhdGFfZW50cnlfMTA5KycgJytsYW5nLmRhdGFfZW50cnlfMTEwKycgJyArIGxhbmcuZGF0YV9lbnRyeV8xMTErJyAoJyArIHRoaXMub2IudmFsdWUgKyAnKSAnK2xhbmcucGVyaW9kKycgJytsYW5nLmRhdGFfZW50cnlfMTA4LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBsYW5nLmRhdGFfZW50cnlfMTA1LCBcclxuICAgICAgICAgICAgICAgICAgICAgICAgJ3N1Zl93YXJuaW5nX2RpYWxvZycsIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICA1MDAsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFwiJCgnI2Zvcm0gOmlucHV0W25hbWU9XCIrdGhpcy5hdHYuZmllbGQrXCJdJykuZm9jdXMoKTtcIiwgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxhbmcuY2FsZW5kYXJfcG9wdXBfMDFcclxuICAgICAgICAgICAgICAgICAgICApOyAgICAgXHJcbiAgICAgICAgICAgICAgICB9ICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICBjYXNlICdzaG93LXdhcm5pbmcnOlxyXG4gICAgICAgICAgICAgICAgU1RQSF9VbmlxdWVBVC5sb2coJ1dhcm4gb2YgZHVwbGljYXRlIGZvciBmaWVsZCAnICsgdGhpcy5hdHYuZmllbGQgKTtcclxuICAgICAgICAgICAgICAgIHRoaXMub2Iuc3R5bGUuZm9udFdlaWdodCA9ICdib2xkJzsgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgdGhpcy5vYi5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSAnI0ZGQjdCRSc7XHJcbiAgICAgXHJcbiAgICAgICAgICAgICAgICBpZihkaWFsb2cpe1xyXG4gICAgICAgICAgICAgICAgICAgIHNpbXBsZURpYWxvZygnV2FybmluZzogWW91IGhhdmUgZW50ZXJlZCBhIGR1cGxpY2F0ZSB2YWx1ZSBpbiBmaWVsZChzKSAnKyB3YXJuaW5ncyArJyAgaW4gY29uZmxpY3QgdG8gJyArIHRoaXMuYXR2LmZpZWxkKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgY2FzZSAncmVtb3ZlLXdhcm5pbmcnOlxyXG4gICAgICAgICAgICAgICAgdGhpcy5vYi5zdHlsZS5mb250V2VpZ2h0ID0gJ25vcm1hbCc7XHJcbiAgICAgICAgICAgICAgICB0aGlzLm9iLnN0eWxlLmJhY2tncm91bmRDb2xvciA9ICcjRkZGRkZGJztcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBcclxuXHJcbiAgICAgICAgICAgIGNhc2UgJ3JlbW92ZS1kdXBsaWNhdGUnOlxyXG4gICAgICAgICAgICAgICAgdGhpcy5vYi5zdHlsZS5mb250V2VpZ2h0ID0gJ25vcm1hbCc7XHJcbiAgICAgICAgICAgICAgICB0aGlzLm9iLnN0eWxlLmJhY2tncm91bmRDb2xvciA9ICcjRkZGRkZGJzsgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn0iXX0=