"use strict";function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}var STPH_UniqueAT=STPH_UniqueAT||{};STPH_UniqueAT.log=function(){if(STPH_UniqueAT.params.debug)switch(arguments.length){case 1:return void console.log(arguments[0]);case 2:return void console.log(arguments[0],arguments[1]);case 3:return void console.log(arguments[0],arguments[1],arguments[2]);case 4:return void console.log(arguments[0],arguments[1],arguments[2],arguments[3]);default:console.log(arguments);}},STPH_UniqueAT.init=function(){STPH_UniqueAT.log("Unique Action Tag - Initializing",STPH_UniqueAT),$("#field_validation_error_state").val(1),STPH_UniqueAT.params.errors,Object.keys(STPH_UniqueAT.params.actionTags).forEach(function(a){var b=STPH_UniqueAT.params.actionTags[a];Object.values(b).forEach(function(a){if("text"==a.type)for(var b=0;b<a.tagPerFieldCount;b++)a[b]&&new STPH_UniqueAT.ActionTagClass(a[b],a.tag).init()})})},STPH_UniqueAT.ActionTagClass=function(){function a(b,c){_classCallCheck(this,a),this.atv=b,this.ob=document.getElementsByName(this.atv.field)[0],this.request=STPH_UniqueAT.request,this.requestUrl=STPH_UniqueAT.request.url,this.requestData={tag:c,value:null,field:this.atv.field,targets:this.atv.targets,pid:this.request.pid,record:this.request.record,event_id:this.request.event_id,instance:this.request.instance}}return _createClass(a,[{key:"init",value:function init(){this.writeLabels(),this.bindOnChange(),this.bindOnBlur(),this.ajaxCheckUnique("on-load")}},{key:"writeLabels",value:function writeLabels(){if(STPH_UniqueAT.params.labels){STPH_UniqueAT.log("["+this.requestData.tag+"]["+this.atv.field+"] Apply actiontag with target(s): "+this.atv.targets+".)");var a=$("#label-"+this.atv.field+" tr").find("td:first");a.html(a.text()+"<div style=\"font-weight:100;font-size:12px;\">("+this.requestData.tag+")</div>")}}},{key:"bindOnChange",value:function bindOnChange(){var a=this;if("@UNIQUE-STRICT"==this.requestData.tag){var b=this.requestData.targets,c=function(c){b[c]==a.requestData.field?$("input[name="+b[c]+"]").bind("afterAjaxCheck",function(){console.log("After ajax done."),a.onPageCheckUnique(b[c])}):$("input[name="+b[c]+"]").bind("change",function(){a.onPageCheckUnique(b[c])})};for(var d in b)c(d)}}},{key:"onPageCheckUnique",value:function onPageCheckUnique(){var a=this;if(0<this.requestData.value.length){this.toggleUI("start-load");var b=[],c=this.requestData.targets.filter(function(b){return b!==a.requestData.field});c.forEach(function(c){var d=$("input[name="+c+"]");d.val()==a.requestData.value?(d.css("background-color","#FFB7BE"),d.css("font-weight","bold"),b.push(c)):(d.css("background-color","#FFFFFF"),d.css("font-weight","normal"))}),0<b.length?this.toggleUI("show-warning",!0,b):this.toggleUI("remove-warning"),this.toggleUI("stop-load")}else this.toggleUI("remove-warning")}},{key:"bindOnBlur",value:function bindOnBlur(){var a=this;STPH_UniqueAT.log("["+this.requestData.tag+"]["+this.atv.field+"] Bind \"onblur\" event."),$("input[name="+this.atv.field+"]").bind("blur",function(){a.ajaxCheckUnique("on-blur")})}},{key:"ajaxCheckUnique",value:function ajaxCheckUnique(a){var b=this;this.requestData.value=trim(this.ob.value),0<this.requestData.value.length?(this.toggleUI("start-load"),$.post(this.requestUrl,{data:this.requestData}).done(function(c){0==c?(b.toggleUI("remove-duplicate"),$("input[name="+b.requestData.field+"]").trigger("afterAjaxCheck")):b.toggleUI("show-duplicate","on-blur"==a),b.toggleUI("stop-load")}).fail(function(a){STPH_UniqueAT.log(a),alert(woops),b.toggleUI("stop-load")})):this.toggleUI("remove-duplicate")}},{key:"toggleUI",value:function toggleUI(a){var b=!!(1<arguments.length&&void 0!==arguments[1])&&arguments[1],c=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;"start-load"===a?(this.ob.classList.add("loading-unique"),$("#formSaveTip button, #form :input[name=\""+this.atv.field+"\"], #form button").prop("disabled",!0)):"stop-load"===a?(this.ob.classList.remove("loading-unique"),$("#formSaveTip button, #form :input[name=\""+this.atv.field+"\"], #form button").prop("disabled",!1)):"show-duplicate"===a?(STPH_UniqueAT.log("Detect duplicate for field "+this.atv.field),this.ob.style.fontWeight="bold",this.ob.style.backgroundColor="#FFB7BE",b&&simpleDialog("The current field is a unique field (@UNIQUE action tag)"+lang.data_entry_107+" "+lang.data_entry_109+" "+lang.data_entry_110+" "+lang.data_entry_111+" ("+this.ob.value+") "+lang.period+" "+lang.data_entry_108,lang.data_entry_105,"suf_warning_dialog",500,"$('#form :input[name="+this.atv.field+"]').focus();",lang.calendar_popup_01)):"show-warning"===a?(STPH_UniqueAT.log("Warn of duplicate for field "+this.atv.field),this.ob.style.fontWeight="bold",this.ob.style.backgroundColor="#FFB7BE",b&&simpleDialog("Warning: You have entered a duplicate value in field(s) "+c+"  in conflict to "+this.atv.field)):"remove-warning"===a?(this.ob.style.fontWeight="normal",this.ob.style.backgroundColor="#FFFFFF"):"remove-duplicate"===a?(this.ob.style.fontWeight="normal",this.ob.style.backgroundColor="#FFFFFF"):void 0}}]),a}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9qcy91bmlxdWUuanMiXSwibmFtZXMiOlsiU1RQSF9VbmlxdWVBVCIsImxvZyIsInBhcmFtcyIsImRlYnVnIiwiYXJndW1lbnRzIiwibGVuZ3RoIiwiY29uc29sZSIsImluaXQiLCIkIiwidmFsIiwiZXJyb3JzIiwiT2JqZWN0Iiwia2V5cyIsImFjdGlvblRhZ3MiLCJmb3JFYWNoIiwiYWN0aW9uVGFnTmFtZSIsImFjdGlvblRhZ3NPYmplY3QiLCJ2YWx1ZXMiLCJmaWVsZEluZm8iLCJ0eXBlIiwiaSIsInRhZ1BlckZpZWxkQ291bnQiLCJBY3Rpb25UYWdDbGFzcyIsInRhZyIsImFjdGlvblRhZ1ZhbHVlIiwiYWN0aW9uVGFnTGl0ZXJhbCIsImF0diIsIm9iIiwiZG9jdW1lbnQiLCJnZXRFbGVtZW50c0J5TmFtZSIsImZpZWxkIiwicmVxdWVzdCIsInJlcXVlc3RVcmwiLCJ1cmwiLCJyZXF1ZXN0RGF0YSIsInZhbHVlIiwidGFyZ2V0cyIsInBpZCIsInJlY29yZCIsImV2ZW50X2lkIiwiaW5zdGFuY2UiLCJ3cml0ZUxhYmVscyIsImJpbmRPbkNoYW5nZSIsImJpbmRPbkJsdXIiLCJhamF4Q2hlY2tVbmlxdWUiLCJsYWJlbHMiLCJsYWJlbCIsImZpbmQiLCJodG1sIiwidGV4dCIsIm9iaiIsInByb3AiLCJiaW5kIiwib25QYWdlQ2hlY2tVbmlxdWUiLCJ0b2dnbGVVSSIsIndhcm5pbmdzIiwiZmlsdGVyZWRUYXJnZXRzIiwiZmlsdGVyIiwiaXRlbSIsIml0ZW1PYmoiLCJjc3MiLCJwdXNoIiwidHJpZ2dlciIsInRyaW0iLCJwb3N0IiwiZGF0YSIsImRvbmUiLCJyZXNwb25zZSIsImZhaWwiLCJlcnJvciIsImFsZXJ0Iiwid29vcHMiLCJwaGFzZSIsImRpYWxvZyIsImNsYXNzTGlzdCIsImFkZCIsInJlbW92ZSIsInN0eWxlIiwiZm9udFdlaWdodCIsImJhY2tncm91bmRDb2xvciIsInNpbXBsZURpYWxvZyIsImxhbmciLCJkYXRhX2VudHJ5XzEwNyIsImRhdGFfZW50cnlfMTA5IiwiZGF0YV9lbnRyeV8xMTAiLCJkYXRhX2VudHJ5XzExMSIsInBlcmlvZCIsImRhdGFfZW50cnlfMTA4IiwiZGF0YV9lbnRyeV8xMDUiLCJjYWxlbmRhcl9wb3B1cF8wMSJdLCJtYXBwaW5ncyI6IitZQWlCQyxHQUFJQSxDQUFBQSxhQUFhLENBQUdBLGFBQWEsRUFBSSxFQUFyQyxDQUdBQSxhQUFhLENBQUNDLEdBQWQsQ0FBb0IsVUFBVyxDQUM1QixHQUFJRCxhQUFhLENBQUNFLE1BQWQsQ0FBcUJDLEtBQXpCLENBQ0ksT0FBT0MsU0FBUyxDQUFDQyxNQUFqQixFQUNJLElBQUssRUFBTCxDQUVJLFdBREFDLENBQUFBLE9BQU8sQ0FBQ0wsR0FBUixDQUFZRyxTQUFTLENBQUMsQ0FBRCxDQUFyQixDQUNBLENBQ0osSUFBSyxFQUFMLENBRUksV0FEQUUsQ0FBQUEsT0FBTyxDQUFDTCxHQUFSLENBQVlHLFNBQVMsQ0FBQyxDQUFELENBQXJCLENBQTBCQSxTQUFTLENBQUMsQ0FBRCxDQUFuQyxDQUNBLENBQ0osSUFBSyxFQUFMLENBRUksV0FEQUUsQ0FBQUEsT0FBTyxDQUFDTCxHQUFSLENBQVlHLFNBQVMsQ0FBQyxDQUFELENBQXJCLENBQTBCQSxTQUFTLENBQUMsQ0FBRCxDQUFuQyxDQUF3Q0EsU0FBUyxDQUFDLENBQUQsQ0FBakQsQ0FDQSxDQUNKLElBQUssRUFBTCxDQUVJLFdBREFFLENBQUFBLE9BQU8sQ0FBQ0wsR0FBUixDQUFZRyxTQUFTLENBQUMsQ0FBRCxDQUFyQixDQUEwQkEsU0FBUyxDQUFDLENBQUQsQ0FBbkMsQ0FBd0NBLFNBQVMsQ0FBQyxDQUFELENBQWpELENBQXNEQSxTQUFTLENBQUMsQ0FBRCxDQUEvRCxDQUNBLENBQ0osUUFDSUUsT0FBTyxDQUFDTCxHQUFSLENBQVlHLFNBQVosQ0FESixDQWJKLENBaUJQLEMsQ0FHREosYUFBYSxDQUFDTyxJQUFkLENBQXFCLFVBQVcsQ0FFNUJQLGFBQWEsQ0FBQ0MsR0FBZCxDQUFrQixrQ0FBbEIsQ0FBc0RE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Q0FNUm1ELElBQUksQ0FBQ1EsaUJBTkcsQ0FqQm9CLEVBNEJuQyxjQTVCbUMsR0FDckNqQixDQURxQyxFQTZCcEN4RSxhQUFhLENBQUNDLEdBQWQsQ0FBa0IsK0JBQWlDLEtBQUt5QixHQUFMLENBQVNJLEtBQTVELENBN0JvQyxDQThCcEMsS0FBS0gsRUFBTCxDQUFRa0QsS0FBUixDQUFjQyxVQUFkLENBQTJCLE1BOUJTLENBK0JwQyxLQUFLbkQsRUFBTCxDQUFRa0QsS0FBUixDQUFjRSxlQUFkLENBQWdDLFNBL0JJLENBaUNqQ04sQ0FqQ2lDLEVBa0NoQ08sWUFBWSxDQUFDLDJEQUE0RHpCLENBQTVELENBQXNFLG1CQUF0RSxDQUE0RixLQUFLN0IsR0FBTCxDQUFTSSxLQUF0RyxDQWxDb0IsRUFzQ25DLGdCQXRDbUMsR0FDckMwQyxDQURxQyxFQXVDcEMsS0FBSzdDLEVBQUwsQ0FBUWtELEtBQVIsQ0FBY0MsVUFBZCxDQUEyQixRQXZDUyxDQXdDcEMsS0FBS25ELEVBQUwsQ0FBUWtELEtBQVIsQ0FBY0UsZUFBZCxDQUFnQyxTQXhDSSxFQTRDbkMsa0JBNUNtQyxHQUNyQ1AsQ0FEcUMsRUE2Q3BDLEtBQUs3QyxFQUFMLENBQVFrRCxLQUFSLENBQWNDLFVBQWQsQ0FBMkIsUUE3Q1MsQ0E4Q3BDLEtBQUtuRCxFQUFMLENBQVFrRCxLQUFSLENBQWNFLGVBQWQsQ0FBZ0MsU0E5Q0ksUUFpRC9DLENBbkxMLFEiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcclxuICogVW5pcXVlIEFjdGlvbiBUYWcgLSBBIFJFRENhcCBleHRlcm5hbCBtb2R1bGUgcHJvdmlkaW5nIGFjdGlvbiB0YWdzIHRoYXQgbWFrZSBmaWVsZHMgdW5pcXVlLlxyXG4gKiBBdXRob3I6IEVraW4gVGVydGVtaXpcclxuICogXHJcbiAqIFxyXG4gKiBEZXZlbG9wZXIgTm90ZTogQmFiZWwgSmF2YXNjcmlwdCBjb21waWxhdGlvblxyXG4gKiBUaGUgbW9kdWxlIGlzIHVzaW5nIGEgQmFiZWwgY29tcGlsZWQgdmVyc2lvbiBvZiB0aGlzIGNvZGUgdG8gZW5zdXJlIG1vZGVybiBKYXZhc2NyaXB0IGNhbiBiZSB1c2VkIHdpdGhvdXQgbG9zaW5nIEJyb3dzZXIgU3VwcG9ydC4gXHJcbiAqIFJ1biBgbnBtIHJ1biBidWlsZGAgb3IgYG5wbSBydW4gZGV2YCBhZnRlciBtYWtpbmcgY29kZSBjaGFuZ2VzIHRvIHlvdXIgSmF2YWNzcmlwdC5cclxuICogQWxzbyBlbnN1cmUgdGhhdCB5b3UgaGF2ZSBOb2RlLmpzIHJ1bm5pbmcgb24geW91ciBsb2NhbCBkZXZlbG9wbWVudCBtYWNoaW5lIFxyXG4gKiBhbmQgaGF2ZSBpbnN0YWxsZWQgYWxsIG5lY2Vzc2FyeSBsb2NhbCBkZXBlbmRlbmNpZXMgd2l0aCBgbnBtIGluc3RhbGxgLlxyXG4gKiBcclxuICogQ3JlZGl0czogXHJcbiAqIC0gR8O8bnRoZXIgUmV6bmljemVrOyBBIGxvdCBvZiB0aGlzIGNvZGUgaXMgYmFzZWQgb24gdGhlIFJFRENhcCBBdXRvZmlsbCBFeHRlcm5hbCBNb2R1bGUuIChodHRwczovL2dpdGh1Yi5jb20vZ3Jlem5pY3play9yZWRjYXBfYXV0b2ZpbGwpXHJcbiAqIC0gQW5keSBNYXJ0aW47IFRvIHBhcnNlIEFjdGlvblRhZ3MgZnJvbSB0aGUgZmllbGQgYW5ub3RhdGlvbnMgQWN0aW9uVGFnSGVscGVyIGNsYXNzIGlzIHVzZWQuIChodHRwczovL2dpc3QuZ2l0aHViLmNvbS8xMjNhbmR5L2RkMjYyNDM5YzA0NzhmZmJkMzdlNDY4NWJjODAxN2FjKVxyXG4gKiBcclxuICovXHJcblxyXG4gdmFyIFNUUEhfVW5pcXVlQVQgPSBTVFBIX1VuaXF1ZUFUIHx8IHt9O1xyXG5cclxuIC8vIERlYnVnIGxvZ2dpbmdcclxuIFNUUEhfVW5pcXVlQVQubG9nID0gZnVuY3Rpb24oKSB7XHJcbiAgICBpZiAoU1RQSF9VbmlxdWVBVC5wYXJhbXMuZGVidWcpIHtcclxuICAgICAgICBzd2l0Y2goYXJndW1lbnRzLmxlbmd0aCkge1xyXG4gICAgICAgICAgICBjYXNlIDE6IFxyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coYXJndW1lbnRzWzBdKTsgXHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIGNhc2UgMjogXHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhhcmd1bWVudHNbMF0sIGFyZ3VtZW50c1sxXSk7IFxyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICBjYXNlIDM6IFxyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coYXJndW1lbnRzWzBdLCBhcmd1bWVudHNbMV0sIGFyZ3VtZW50c1syXSk7IFxyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICBjYXNlIDQ6XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhhcmd1bWVudHNbMF0sIGFyZ3VtZW50c1sxXSwgYXJndW1lbnRzWzJdLCBhcmd1bWVudHNbM10pOyBcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGFyZ3VtZW50cyk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59O1xyXG5cclxuLy8gSW5pdGlhbGl6YXRpb25cclxuU1RQSF9VbmlxdWVBVC5pbml0ID0gZnVuY3Rpb24oKSB7XHJcblxyXG4gICAgU1RQSF9VbmlxdWVBVC5sb2coXCJVbmlxdWUgQWN0aW9uIFRhZyAtIEluaXRpYWxpemluZ1wiLCBTVFBIX1VuaXF1ZUFUKTtcclxuXHJcbiAgICAvLyAgVGhpcyBpcyBub3QgY2xlYW4sIGJ1dCBjYW5ub3Qgb3RoZXJ3aXNlIHByZXZlbnQgZm9ybSBzdWJtaXQgb24gZW50ZXIsIGkuZS5wcmV2ZW50RGVmYXVsdCgpIG9uIGtleWRvd24gaGFzIG5vIGVmZmVjdCBvbiBmb3JtIHN1Ym1pc3Npb24uIFdvdWxkIGJlIGhhcHB5IGFib3V0IGEgZml4IDopXHJcbiAgICAkKCcjZmllbGRfdmFsaWRhdGlvbl9lcnJvcl9zdGF0ZScpLnZhbCgxKVxyXG5cclxuICAgIC8vIENoZWNrIGZvciBlcnJvcnNcclxuICAgIGlmIChTVFBIX1VuaXF1ZUFULnBhcmFtcy5lcnJvcnMpIHtcclxuICAgICAgICAvL3Nob3dFcnJvcihTVFBIX1VuaXF1ZUFULnBhcmFtcy51bmlxdWUpOyAgICAgICAgXHJcbiAgICB9XHJcblxyXG4gICAgLy8gTG9vcCBvdmVyIGFsbCBBY3Rpb24gVGFncyBhbmQgaW5pdGlhdGUgYSBjbGFzcyBmb3IgZWFjaCBmaWVsZCB0aGF0IGhhcyBhIHZhbGlkIEFjdGlvbiBUYWdcclxuICAgIE9iamVjdC5rZXlzKFNUUEhfVW5pcXVlQVQucGFyYW1zLmFjdGlvblRhZ3MpLmZvckVhY2goZnVuY3Rpb24oYWN0aW9uVGFnTmFtZSl7XHJcbiAgICAgICAgdmFyIGFjdGlvblRhZ3NPYmplY3QgPSBTVFBIX1VuaXF1ZUFULnBhcmFtcy5hY3Rpb25UYWdzW2FjdGlvblRhZ05hbWVdO1xyXG4gICAgICAgIE9iamVjdC52YWx1ZXMoYWN0aW9uVGFnc09iamVjdCkuZm9yRWFjaCggKGZpZWxkSW5mbykgPT4ge1xyXG5cclxuICAgICAgICAgICAgLy8gIE9ubHkgYWNjZXB0IGZpZWxkIHR5cGUgXCJ0ZXh0XCJcclxuICAgICAgICAgICAgaWYoZmllbGRJbmZvLnR5cGUgPT0gXCJ0ZXh0XCIpIHtcclxuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZmllbGRJbmZvLnRhZ1BlckZpZWxkQ291bnQ7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChmaWVsZEluZm9baV0pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbmV3IFNUUEhfVW5pcXVlQVQuQWN0aW9uVGFnQ2xhc3MoZmllbGRJbmZvW2ldLCBmaWVsZEluZm8udGFnKS5pbml0KCk7ICBcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KVxyXG4gICAgfSk7XHJcblxyXG59XHJcblxyXG5TVFBIX1VuaXF1ZUFULkFjdGlvblRhZ0NsYXNzID0gY2xhc3Mge1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKGFjdGlvblRhZ1ZhbHVlLCBhY3Rpb25UYWdMaXRlcmFsKSB7XHJcbiAgICAgICAgdGhpcy5hdHYgPSBhY3Rpb25UYWdWYWx1ZTtcclxuICAgICAgICB0aGlzLm9iID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeU5hbWUodGhpcy5hdHYuZmllbGQpWzBdO1xyXG4gICAgICAgIHRoaXMucmVxdWVzdCA9IFNUUEhfVW5pcXVlQVQucmVxdWVzdCxcclxuICAgICAgICB0aGlzLnJlcXVlc3RVcmwgPSAgU1RQSF9VbmlxdWVBVC5yZXF1ZXN0LnVybCxcclxuICAgICAgICB0aGlzLnJlcXVlc3REYXRhID0ge1xyXG4gICAgICAgICAgICB0YWc6IGFjdGlvblRhZ0xpdGVyYWwsXHJcbiAgICAgICAgICAgIHZhbHVlOiBudWxsLFxyXG4gICAgICAgICAgICBmaWVsZDogdGhpcy5hdHYuZmllbGQsXHJcbiAgICAgICAgICAgIHRhcmdldHM6IHRoaXMuYXR2LnRhcmdldHMsXHJcbiAgICAgICAgICAgIHBpZDogIHRoaXMucmVxdWVzdC5waWQsXHJcbiAgICAgICAgICAgIHJlY29yZDogIHRoaXMucmVxdWVzdC5yZWNvcmQsXHJcbiAgICAgICAgICAgIGV2ZW50X2lkOiAgdGhpcy5yZXF1ZXN0LmV2ZW50X2lkLFxyXG4gICAgICAgICAgICBpbnN0YW5jZTogIHRoaXMucmVxdWVzdC5pbnN0YW5jZVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBpbml0KCkge1xyXG4gICAgICAgIHRoaXMud3JpdGVMYWJlbHMoKTtcclxuICAgICAgICB0aGlzLmJpbmRPbkNoYW5nZSgpO1xyXG4gICAgICAgIHRoaXMuYmluZE9uQmx1cigpO1xyXG4gICAgICAgIHRoaXMuYWpheENoZWNrVW5pcXVlKCdvbi1sb2FkJyk7XHJcbiAgICB9XHJcblxyXG4gICAgd3JpdGVMYWJlbHMoKSB7XHJcbiAgICAgICAgaWYgKFNUUEhfVW5pcXVlQVQucGFyYW1zLmxhYmVscykge1xyXG4gICAgICAgICAgICBTVFBIX1VuaXF1ZUFULmxvZygnWycrIHRoaXMucmVxdWVzdERhdGEudGFnICsnXVsnICsgdGhpcy5hdHYuZmllbGQgKyAnXSBBcHBseSBhY3Rpb250YWcgd2l0aCB0YXJnZXQocyk6ICcgKyB0aGlzLmF0di50YXJnZXRzICsgJy4pJyk7XHJcbiAgICAgICAgICAgIHZhciBsYWJlbCA9ICQoJyNsYWJlbC0nK3RoaXMuYXR2LmZpZWxkKycgdHInKS5maW5kKFwidGQ6Zmlyc3RcIik7XHJcbiAgICAgICAgICAgIGxhYmVsLmh0bWwobGFiZWwudGV4dCgpICsgJzxkaXYgc3R5bGU9XCJmb250LXdlaWdodDoxMDA7Zm9udC1zaXplOjEycHg7XCI+KCcrdGhpcy5yZXF1ZXN0RGF0YS50YWcrJyk8L2Rpdj4nKVxyXG4gICAgICAgIH1cclxuXHJcbiAgICB9XHJcblxyXG4gICAgYmluZE9uQ2hhbmdlKCkge1xyXG4gICAgICAgIC8vICBPbmx5IGZvciBAVU5JUVVFLVNUUklDVCB0YWdzXHJcbiAgICAgICAgaWYodGhpcy5yZXF1ZXN0RGF0YS50YWcgPT0gXCJAVU5JUVVFLVNUUklDVFwiKSB7XHJcbiAgICAgICAgICAgIHZhciBvYmogPSB0aGlzLnJlcXVlc3REYXRhLnRhcmdldHM7XHJcbiAgICAgICAgICAgIGZvciAoY29uc3QgcHJvcCBpbiBvYmopIHtcclxuICAgICAgICAgICAgICAgIGlmICggb2JqW3Byb3BdICE9IHRoaXMucmVxdWVzdERhdGEuZmllbGQgKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gIG9ialtwcm9wXSAhPSB0aGlzLnJlcXVlc3REYXRhLmZpZWxkXHJcbiAgICAgICAgICAgICAgICAgICAgJCgnaW5wdXRbbmFtZT0nICsgb2JqW3Byb3BdICsgJ10nKS5iaW5kKCdjaGFuZ2UnLCAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMub25QYWdlQ2hlY2tVbmlxdWUob2JqW3Byb3BdKTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJCgnaW5wdXRbbmFtZT0nICsgb2JqW3Byb3BdICsgJ10nKS5iaW5kKCdhZnRlckFqYXhDaGVjaycsICgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJBZnRlciBhamF4IGRvbmUuXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm9uUGFnZUNoZWNrVW5pcXVlKG9ialtwcm9wXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBvblBhZ2VDaGVja1VuaXF1ZSgpIHtcclxuICAgICAgICBpZih0aGlzLnJlcXVlc3REYXRhLnZhbHVlLmxlbmd0aCA+IDAgKSB7ICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIHRoaXMudG9nZ2xlVUkoJ3N0YXJ0LWxvYWQnKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIHZhciB3YXJuaW5ncyA9IFtdOyAgICAgICAgICAgIFxyXG4gICAgICAgICAgICB2YXIgZmlsdGVyZWRUYXJnZXRzID0gdGhpcy5yZXF1ZXN0RGF0YS50YXJnZXRzLmZpbHRlcigoaXRlbSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGl0ZW0gIT09IHRoaXMucmVxdWVzdERhdGEuZmllbGQ7XHJcbiAgICAgICAgICAgIH0pXHJcblxyXG4gICAgICAgICAgICBmaWx0ZXJlZFRhcmdldHMuZm9yRWFjaCggKGl0ZW0pID0+IHsgXHJcbiAgICAgICAgICAgICAgICB2YXIgaXRlbU9iaiA9ICQoJ2lucHV0W25hbWU9JytpdGVtKyddJyk7XHJcbiAgICAgICAgICAgICAgICBpZiggaXRlbU9iai52YWwoKSA9PSB0aGlzLnJlcXVlc3REYXRhLnZhbHVlICkge1xyXG4gICAgICAgICAgICAgICAgICAgIGl0ZW1PYmouY3NzKFwiYmFja2dyb3VuZC1jb2xvclwiLCBcIiNGRkI3QkVcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgaXRlbU9iai5jc3MoXCJmb250LXdlaWdodFwiLCBcImJvbGRcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgd2FybmluZ3MucHVzaChpdGVtKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaXRlbU9iai5jc3MoXCJiYWNrZ3JvdW5kLWNvbG9yXCIsIFwiI0ZGRkZGRlwiKTtcclxuICAgICAgICAgICAgICAgICAgICBpdGVtT2JqLmNzcyhcImZvbnQtd2VpZ2h0XCIsIFwibm9ybWFsXCIpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KVxyXG5cclxuICAgICAgICAgICAgaWYod2FybmluZ3MubGVuZ3RoID4gMCl7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnRvZ2dsZVVJKCdzaG93LXdhcm5pbmcnLCB0cnVlLCB3YXJuaW5ncyk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnRvZ2dsZVVJKCdyZW1vdmUtd2FybmluZycpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICB0aGlzLnRvZ2dsZVVJKCdzdG9wLWxvYWQnKTtcclxuXHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy50b2dnbGVVSSgncmVtb3ZlLXdhcm5pbmcnKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgYmluZE9uQmx1cigpIHtcclxuICAgICAgICBTVFBIX1VuaXF1ZUFULmxvZygnWycrIHRoaXMucmVxdWVzdERhdGEudGFnICsnXVsnICsgdGhpcy5hdHYuZmllbGQgKyAnXSBCaW5kIFwib25ibHVyXCIgZXZlbnQuJyk7ICAgICAgICBcclxuICAgICAgICAkKCdpbnB1dFtuYW1lPScgKyB0aGlzLmF0di5maWVsZCArICddJykuYmluZCgnYmx1cicsICgpID0+IHtcclxuICAgICAgICAgICAgdGhpcy5hamF4Q2hlY2tVbmlxdWUoJ29uLWJsdXInKTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBhamF4Q2hlY2tVbmlxdWUodHJpZ2dlcikge1xyXG4gICAgICAgIHZhciBkaWFsb2cgPSB0cmlnZ2VyID09ICdvbi1ibHVyJyA/IHRydWUgOiBmYWxzZTtcclxuICAgICAgICB0aGlzLnJlcXVlc3REYXRhLnZhbHVlID0gdHJpbSh0aGlzLm9iLnZhbHVlKTtcclxuXHJcbiAgICAgICAgaWYodGhpcy5yZXF1ZXN0RGF0YS52YWx1ZS5sZW5ndGggPiAwICkge1xyXG4gICAgICAgICAgICB0aGlzLnRvZ2dsZVVJKCdzdGFydC1sb2FkJyk7XHJcblxyXG4gICAgICAgICAgICAkLnBvc3QoIFxyXG4gICAgICAgICAgICAgICAgdGhpcy5yZXF1ZXN0VXJsLCBcclxuICAgICAgICAgICAgICAgIHsgXHJcbiAgICAgICAgICAgICAgICAgICAgZGF0YTogdGhpcy5yZXF1ZXN0RGF0YSBcclxuICAgICAgICAgICAgICAgIH0gXHJcbiAgICAgICAgICAgIClcclxuICAgICAgICAgICAgLmRvbmUoKHJlc3BvbnNlKSA9PiB7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYocmVzcG9uc2UgIT0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMudG9nZ2xlVUkoJ3Nob3ctZHVwbGljYXRlJywgZGlhbG9nKVxyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnRvZ2dsZVVJKCdyZW1vdmUtZHVwbGljYXRlJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgJCgnaW5wdXRbbmFtZT0nICsgdGhpcy5yZXF1ZXN0RGF0YS5maWVsZCArICddJykudHJpZ2dlcihcImFmdGVyQWpheENoZWNrXCIpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgdGhpcy50b2dnbGVVSSgnc3RvcC1sb2FkJyk7XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIC5mYWlsKCAoZXJyb3IpID0+IHtcclxuICAgICAgICAgICAgICAgIFNUUEhfVW5pcXVlQVQubG9nKGVycm9yKTtcclxuICAgICAgICAgICAgICAgIGFsZXJ0KHdvb3BzKTtcclxuICAgICAgICAgICAgICAgIHRoaXMudG9nZ2xlVUkoJ3N0b3AtbG9hZCcpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMudG9nZ2xlVUkoJ3JlbW92ZS1kdXBsaWNhdGUnKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgdG9nZ2xlVUkocGhhc2UsIGRpYWxvZyA9IGZhbHNlLCB3YXJuaW5ncyA9IG51bGwpe1xyXG4gICAgICAgIHN3aXRjaChwaGFzZSkge1xyXG4gICAgICAgICAgICBjYXNlICdzdGFydC1sb2FkJzpcclxuICAgICAgICAgICAgICAgIHRoaXMub2IuY2xhc3NMaXN0LmFkZCgnbG9hZGluZy11bmlxdWUnKTtcclxuICAgICAgICAgICAgICAgICQoJyNmb3JtU2F2ZVRpcCBidXR0b24sICNmb3JtIDppbnB1dFtuYW1lPVwiJysgdGhpcy5hdHYuZmllbGQgKydcIl0sICNmb3JtIGJ1dHRvbicpLnByb3AoXCJkaXNhYmxlZFwiLCB0cnVlKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGNhc2UgJ3N0b3AtbG9hZCc6IFxyXG4gICAgICAgICAgICAgICAgdGhpcy5vYi5jbGFzc0xpc3QucmVtb3ZlKCdsb2FkaW5nLXVuaXF1ZScpO1xyXG4gICAgICAgICAgICAgICAgJCgnI2Zvcm1TYXZlVGlwIGJ1dHRvbiwgI2Zvcm0gOmlucHV0W25hbWU9XCInKyB0aGlzLmF0di5maWVsZCsnXCJdLCAjZm9ybSBidXR0b24nKS5wcm9wKFwiZGlzYWJsZWRcIiwgZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBjYXNlICdzaG93LWR1cGxpY2F0ZSc6ICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgU1RQSF9VbmlxdWVBVC5sb2coJ0RldGVjdCBkdXBsaWNhdGUgZm9yIGZpZWxkICcgKyB0aGlzLmF0di5maWVsZCApO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5vYi5zdHlsZS5mb250V2VpZ2h0ID0gJ2JvbGQnOyAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIHRoaXMub2Iuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gJyNGRkI3QkUnO1xyXG4gICAgICAgICAgICAgICAgaWYoZGlhbG9nKXtcclxuICAgICAgICAgICAgICAgICAgICBzaW1wbGVEaWFsb2coXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICdUaGUgY3VycmVudCBmaWVsZCBpcyBhIHVuaXF1ZSBmaWVsZCAoQFVOSVFVRSBhY3Rpb24gdGFnKScrbGFuZy5kYXRhX2VudHJ5XzEwNysnICcrbGFuZy5kYXRhX2VudHJ5XzEwOSsnICcrbGFuZy5kYXRhX2VudHJ5XzExMCsnICcgKyBsYW5nLmRhdGFfZW50cnlfMTExKycgKCcgKyB0aGlzLm9iLnZhbHVlICsgJykgJytsYW5nLnBlcmlvZCsnICcrbGFuZy5kYXRhX2VudHJ5XzEwOCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgbGFuZy5kYXRhX2VudHJ5XzEwNSwgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICdzdWZfd2FybmluZ19kaWFsb2cnLCBcclxuICAgICAgICAgICAgICAgICAgICAgICAgNTAwLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBcIiQoJyNmb3JtIDppbnB1dFtuYW1lPVwiK3RoaXMuYXR2LmZpZWxkK1wiXScpLmZvY3VzKCk7XCIsIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBsYW5nLmNhbGVuZGFyX3BvcHVwXzAxXHJcbiAgICAgICAgICAgICAgICAgICAgKTsgICAgIFxyXG4gICAgICAgICAgICAgICAgfSAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgY2FzZSAnc2hvdy13YXJuaW5nJzpcclxuICAgICAgICAgICAgICAgIFNUUEhfVW5pcXVlQVQubG9nKCdXYXJuIG9mIGR1cGxpY2F0ZSBmb3IgZmllbGQgJyArIHRoaXMuYXR2LmZpZWxkICk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLm9iLnN0eWxlLmZvbnRXZWlnaHQgPSAnYm9sZCc7ICAgICAgICBcclxuICAgICAgICAgICAgICAgIHRoaXMub2Iuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gJyNGRkI3QkUnO1xyXG4gICAgIFxyXG4gICAgICAgICAgICAgICAgaWYoZGlhbG9nKXtcclxuICAgICAgICAgICAgICAgICAgICBzaW1wbGVEaWFsb2coJ1dhcm5pbmc6IFlvdSBoYXZlIGVudGVyZWQgYSBkdXBsaWNhdGUgdmFsdWUgaW4gZmllbGQocykgJysgd2FybmluZ3MgKycgIGluIGNvbmZsaWN0IHRvICcgKyB0aGlzLmF0di5maWVsZCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICAgIGNhc2UgJ3JlbW92ZS13YXJuaW5nJzpcclxuICAgICAgICAgICAgICAgIHRoaXMub2Iuc3R5bGUuZm9udFdlaWdodCA9ICdub3JtYWwnO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5vYi5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSAnI0ZGRkZGRic7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgXHJcblxyXG4gICAgICAgICAgICBjYXNlICdyZW1vdmUtZHVwbGljYXRlJzpcclxuICAgICAgICAgICAgICAgIHRoaXMub2Iuc3R5bGUuZm9udFdlaWdodCA9ICdub3JtYWwnO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5vYi5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSAnI0ZGRkZGRic7ICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59Il19